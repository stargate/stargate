/*
 * Copyright The Stargate Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
syntax = "proto3";

import "google/protobuf/wrappers.proto";
import "query.proto";

option java_package = "io.stargate.proto";
option go_package = "stargate/proto";

package stargate;

// COLUMNS

enum ColumnOrderBy {
  ASC = 0x00;
  DESC = 0x01;
}

// INDEXES

message CqlIndex {
  string name = 1;
  string column_name = 2;
  google.protobuf.StringValue custom_type = 3;
  map<string, string> options = 4;
}

// MATERIALIZED VIEWS

message CqlMaterializedView {
  string name = 1;
  map<string, string> options = 2;
  repeated ColumnSpec partition_key_columns = 3;
  repeated ColumnSpec clustering_key_columns = 4;
  repeated ColumnSpec columns = 5;
  map <string, ColumnOrderBy> clustering_orders = 6;
}

// TABLES

message CqlTable {
  string name = 1;
  map<string, string> options = 2;
  repeated ColumnSpec partition_key_columns = 3;
  repeated ColumnSpec clustering_key_columns = 4;
  repeated ColumnSpec static_columns = 5;
  repeated ColumnSpec columns = 6;
  map <string, ColumnOrderBy> clustering_orders = 7;
  repeated CqlIndex indexes = 8;
  repeated CqlMaterializedView materialized_views = 9;
}

// KEYSPACES

message CqlKeyspace {
  string name = 1;
  map<string, string> options = 2;
}

message DescribeKeyspaceQuery {
  string keyspace_name = 1;
}

message CqlKeyspaceDescribe {
  CqlKeyspace cql_keyspace = 1;
  repeated TypeSpec.Udt types = 2;
  repeated CqlTable tables = 3;
  repeated CqlIndex indexes = 4;
  repeated CqlMaterializedView materialized_views = 5;
}

message DescribeTableQuery {
  string keyspace_name = 1;
  string table_name = 2;
}

// Note: the existing Response type is designed for both DML and DDL (schema) queries

// The arguments to a `getSchemaNotifications` query.
// Intentionally empty, the query doesn't take arguments. This only exists for future extensibility.
message GetSchemaNotificationsParams {
}

message SchemaNotification {
  SchemaChange change = 1;

  // The full metadata of the keyspace that was impacted by the change.
  // This is present for every kind of change, except if the keyspace doesn't exist anymore at the
  // time of the notification (note that this is not only for a DROP KEYSPACE event, for example if
  // a keyspace that contained a table gets dropped, the DROP TABLE event will also have no
  // keyspace).
  CqlKeyspaceDescribe keyspace = 2;
}
