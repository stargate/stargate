/*
 * Copyright The Stargate Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
syntax = "proto3";

import "google/protobuf/wrappers.proto";

option java_package = "io.stargate.proto";
option go_package = "stargate/proto";

package stargate;

// TYPES

enum CqlType {
  INT = 0x00;
  FLOAT = 0x01;
  DOUBLE = 0x02;
  BOOLEAN = 0x03;
  STRING = 0x04;
  BYTES = 0x05;
  INET = 0x06;
  UUID = 0x07;
  DATE = 0x08;
  TIME = 0x09;
  VARINT = 0x0A;
  DECIMAL = 0x0B;
  SET = 0x0C;
  LIST = 0x0D;
  MAP = 0x0E;
  UDT = 0x0F;
  TUPLE = 0x10;
}

// USER DEFINED TYPES

message CqlUdtField {
  string name = 1;

  CqlType type = 2;

  // only used for UDTs (UDTs can reference other UDTs, but they must be frozen)
  string cqlTypeName = 3;

  bool frozen = 4;
}

message CqlUserDefinedType {
  string name = 1;

  repeated CqlUdtField type = 2;

}

// COLUMNS

enum CqlColumnOrderBy {
  ASC = 0x00;
  DESC = 0x01;
}

message CqlComplexColumnType {
  CqlType type = 1;

  // only used if type=UDT
  string udtTypeName = 1;

  bool frozen = 2;
}

message CqlColumn {

  string name = 1;

  CqlType type = 2;

  // only used if type=UDT
  string udtTypeName = 3;

  // only used if type is one of {SET, LIST, MAP, TUPLE}
  // for SET and LIST, this will have one element
  //   example: direct_reports set<frozen <fullname>> -> CqlComplexColumnType(UDT, fullname, true)
  //   example: prime_numbers list<int> -> CqlComplexColumnType(INT, null, false)
  // for MAP, this will have one element
  //   example: addresses map<string, frozen<address>> -> CqlComplexColumnType(STRING, null, false),
  //     CqlComplexColumnType(UDT, address, true)
  // for TUPLE, this will have as many elements as are referenced
  //   example: values <tuple<int, text, float>> -> CqlComplexColumnType(INT, null, false),
  //     CqlComplexColumnType(STRING, null, false), CqlComplexColumnType(FLOAT, null, false)
  repeated CqlComplexColumnType complexColumnTypes = 4;

  bool isPartitionKey = 5;

  // only used for clustering columns
  uint32 clusteringColumnOrder = 6;

  bool isFrozen = 7;

  bool isStatic = 8;
}

// TABLES

// TODO ok to make it this simplistic?
message CqlTableOption {

  string name = 1;
  string value = 2;
}

message CqlTable {
  repeated CqlColumn columns = 1;

  repeated CqlTableOption tableOptions = 2;
}

// INDEXES

message CqlIndex {
  // TODO
}

// MATERIALIZED VIEWS

message CqlMaterializedView {
  // TODO
}

// KEYSPACES

message CqlDatacenterReplication {
  string datacenterName = 1;

  uint32 replicationFactor = 2;
}

message CqlKeyspace {

  string name = 1;

  string replicationStrategy = 2;

  repeated CqlDatacenterReplication replicationFactors = 3;

  bool durableWrites = 4;

}

// DESCRIBE KEYSPACE

message DescribeQuery {
  string keyspaceName = 1;
}

message CqlKeyspaceDescribe {

  CqlKeyspace cqlKeyspace = 1;

  repeated CqlUserDefinedType types = 2;

  repeated CqlTable tables = 3;

  repeated CqlIndex indexes = 4;

  repeated CqlMaterializedView materializedViews = 5;
}

// SCHEMA CREATION

message CqlSchemaQuery {
  oneof schema {

    CqlTable table = 1;

    CqlUserDefinedType udt = 2;

    CqlIndex index = 3;

    CqlMaterializedView mv = 4;
  }

  bool ifNotExists = 2;
}

// Note: the existing Response type is designed for both DML and DDL (schema) queries
